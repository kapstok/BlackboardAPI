<html>
    <body>
        <h1>BlackboardAPI Test Page</h1>
        <h2>User</h2>
        <form>
            <label for="idBox">Search by user ID</label><br>
            <input type="text" id="idBox" value="_114444_1">
            <button onclick="loadUserByUserId(document.getElementById('idBox').value)">Submit</button>
        </form>
        <form>
            <label for="usernameBox">Search by user name</label><br>
            <input type="text" id="usernameBox">
            <button onclick="loadUserByUserName(document.getElementById('usernameBox').value)">Submit</button>
        </form>
        <button onclick="loadUser(document.getElementById('idBox').value)">Submit</button>
        <p>Load Enrolled Courses</p>
        <button onclick="loadEnrolledCourses(document.getElementById('idBox').value)">Get!</button>
        <h2>Courses</h2>
        <input type="text" id="cidBox" value="_20166_1">
        <p>Load Course</p>
        <button onclick="loadCourse(document.getElementById('cidBox').value)">Get</button>
        <button onclick="postCourse()">Post</button>
        <button onclick="deleteCourse(document.getElementById('cidBox').value)">Delete</button>
        <button onclick="patchCourse(document.getElementById('cidBox').value)">Patch</button>
        <p>Load Children</p>
        <button onclick="loadCourseChildren(document.getElementById('cidBox').value)">Get All</button>
        <p>Load Contents</p>
        <button onclick="loadCourseContents(document.getElementById('cidBox').value)">Get All</button>
        <button onclick="postCourseContent(document.getElementById('cidBox').value)">Post</button>
        <input type="text" id="contentBox" value="_4430884_1">
        <button onclick="loadCourseContent(document.getElementById('cidBox').value, document.getElementById('contentBox').value)">Get</button>
        <button onclick="deleteCourseContent(document.getElementById('cidBox').value, document.getElementById('contentBox').value)">Delete</button>
        <button onclick="patchCourseContent(document.getElementById('cidBox').value, document.getElementById('contentBox').value)">Patch</button>
        <button onclick="loadCourseContentChildren(document.getElementById('cidBox').value, document.getElementById('contentBox').value)">Get Children</button>
        <button onclick="postCourseContentChildren(document.getElementById('cidBox').value, document.getElementById('contentBox').value)">Post Child</button>

        <h2>Send mail</h2>
        <form>
            <label for="emailTargetBox">Recipients</label><br>
            <select id="emailTargetBox">
                <optgroup label="Presets">
                    <option value="AllUsers">All Users</option>
                    <option value="AllGroups">All Groups</option>
                    <option value="AllTeachers">All Teachers</option>
                    <option value="AllStudents">All Students</option>
                    <option value="AllCourseManagers">All Course Managers</option>
                    <option value="AllObservers">All Observers</option>
                </optgroup>
            </select><br>
            <label for="subjectBox">Subject</label><br>
            <input type="text" max="250" id="subjectBox"><br>
            <label for="bodyBox">Body</label><br>
            <textarea id="bodyBox" rows="7" cols="42"></textarea><br>
            <label for="attachmentBox">Attachment</label><br>
            <input type="file" id="attachmentBox" multiple><br>
            <button onclick="sendMail(
                        document.getElementById('emailTargetBox').value,
                        document.getElementById('subjectBox').value,
                        document.getElementById('bodyBox').value,
                        document.getElementById('attachmentBox').files
                    )">Send!</button>
        </form>
        <h2>Files</h2>
        <button onclick="createFolder(document.getElementById('cidBox').value)">Create Folder</button>
        <script>
            var user = null;
            var course = null;

            function loadUserByUserId(userId) {
                let user = new BB.BBUserInfoById(userId);
                user.getUserInfo().then((result) => {
                    console.log(result);
                });

                console.log(user.getUserName);

                return user;
            }

            function loadEnrolledCourses(userId) {
                if(user == null) {
                    user = userId[0] == '_' ? new BB.BBUserInfoById(userId) : new BB.BBUserInfoByUsername(userId);
                }
                user.getEnrolledCourses().then((result) => {
                    console.log(result);

                })
                return user
            }

            function loadCourse(courseId) {
                course = new BB.BBCourse(courseId);
                course.getCourse().then((result) => {
                    console.log(result);
                })
            }
            function loadUserByUserName(userName) {
                let user = new BB.BBUserInfoByUsername(userName);
                user.getUserInfo().then((result) => {
                    console.log(result);
                });

                console.log(user.getUserId);
            }

            function postCourse() {
                course = new BB.BBCourse();
                course.postCourse().then((result) => {
                    console.log(result);
                })
            }

            function deleteCourse(courseId) {
                course = new BB.BBCourse(courseId);
                course.deleteCourse().then((result) => {
                    console.log(result);
                })
            }

            function patchCourse(courseId) {
                course = new BB.BBCourse(courseId);
                course.patchCourse().then((result) => {
                    console.log(result);
                })
            }

            function loadCourseContents(courseId) {
                course = new BB.BBCourse(courseId);
                course.getCourseContents().then((result) => {
                    console.log(result);
                })
            }

            function postCourseContent(courseId) {
                course = new BB.BBCourse(courseId);
                course.postCourseContent().then((result) => {
                    console.log(result);
                })
            }

            function deleteCourseContent(courseId, contentId) {
                course = new BB.BBCourse(courseId);
                course.deleteCourseContent(contentId).then((result) => {
                    console.log(result);
                })
            }

            function patchCourseContent(courseId, contentId) {
                course = new BB.BBCourse(courseId);
                course.patchCourseContent(contentId).then((result) => {
                    console.log(result);
                })
            }

            function loadCourseContent(courseId, contentId) {
                course = new BB.BBCourse(courseId);
                course.getCourseContent(contentId).then((result) => {
                    console.log(result);
                })
            }

            function loadCourseContentChildren(courseId, contentId) {
                course = new BB.BBCourse(courseId);
                course.getCourseContentChildren(contentId).then((result) => {
                    console.log(result);
                })
            }

            function postCourseContentChildren(courseId, contentId) {
                course = new BB.BBCourse(courseId);
                course.postCourseContentChildren(contentId).then((result) => {
                    console.log(result);
                })
            }


            function loadCourseChildren(courseId) {
                course = new BB.BBCourse(courseId);
                course.getCourseChildren().then((result) => {
                    console.log(result);
                })
            }

            /**
             *
             * @param {string} target
             * @param {string} subject
             * @param {string} body
             * @param {FileList} attachments
             */
            function sendMail(target, subject, body, attachments) {
                let emailTarget;
                switch (target) {
                    case "AllUsers":
                        emailTarget = BB.EmailTarget.AllUsers;
                        break;
                    case "AllGroups":
                        emailTarget = BB.EmailTarget.AllGroups;
                        break;
                    case "AllTeachers":
                        emailTarget = BB.EmailTarget.AllTeachers;
                        break;
                    case "AllStudents":
                        emailTarget = BB.EmailTarget.AllStudents;
                        break;
                    case "AllCourseManagers":
                        emailTarget = BB.EmailTarget.AllCourseManagers;
                        break;
                    case "AllObservers":
                        emailTarget = BB.EmailTarget.AllObservers;
                        break;
                    default:
                        throw new Error('Not supported target!');
                }

                const recipient = new BB.EmailRecipient(emailTarget);
                let email = new BB.BBEmail('_20166_1', recipient);
                email.message = body;
                email.subject = subject;

                for (let i = 0; i < attachments.length; i++) {
                    email.addAttachment(attachments.item(i));
                }

                email.send().then((result)=> {
                    console.log(result);
                });
            }

            function createFolder(courseId){
                if(course == null){
                    course = new BB.BBCourse(courseId);
                }
                file = new BB.BBFile(course)
                console.log(file);
                file.createFolder().then((result) => {
                    console.log(result);
                })
            }

            window.onload = () => {
                BB.Backend.setBackend(new BB.BBIframeBackend());
            }
        </script>

        <script src="client.js"></script>
    </body>
</html>
